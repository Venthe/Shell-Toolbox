---
- name: Install ZSH
  become: true
  ansible.builtin.apt:
    name: "{{item}}"
    state: present
    update_cache: yes
  with_items:
    - zsh
    - fzf
- name: ""
  block:
    - name: delete
      ansible.builtin.file:
        path: "{{ ansible_facts.user_dir }}/.oh-my-zsh"
        state: absent
    - name: install ohmyzsh
      ansible.builtin.shell:
        cmd: sh -c "$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
- name: Git checkout
  ansible.builtin.git:
    depth: 1
    repo: https://github.com/romkatv/powerlevel10k.git
    dest: "{{ ansible_facts.user_dir }}/.oh-my-zsh/themes/powerlevel10k"
- name: Configure zshrc
  ansible.builtin.copy:
    src: .zshrc
    dest: "{{ ansible_facts.user_dir }}/.zshrc"
    mode: "u=rw,g=r,o="
- name: Configure Powerlevel10k
  ansible.builtin.copy:
    src: .p10k.zsh
    dest: "{{ ansible_facts.user_dir }}/.p10k.zsh"
    mode: "u=rw,g=r,o="
- name: change user shell to zsh
  become: true
  user:
    name: "{{ ansible_user_id }}"
    shell: /bin/zsh
